<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Wordle Analyser</title>
<link rel="manifest" href="/wordleanalyser/manifest.json">
<style>
  body { font-family: Arial, sans-serif; margin: 2em; }
  input, button { font-size: 1em; padding: 0.3em; }
  .words-list { margin-top: 0.5em; max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 0.5em; }
  .words-list span { display: inline-block; margin: 0.2em 0.5em 0.2em 0; background: #eee; padding: 0.2em 0.5em; border-radius: 0.3em; cursor: default; }
</style>
</head>
<body>

<h2>Wordle Analyser</h2>

<label>
  Solution:
  <input type="text" id="solutionInput" maxlength="5" style="width: 85px; text-transform:uppercase" />
</label>
<br /><br />

<label>
  Enter Guesses (space separated):
  <input type="text" id="guessesInput" style="width: 300px; text-transform:uppercase" />
</label>
<br /><br />

<button id="analyzeBtn" disabled>Analyse</button>
<p></p>
<button id="toggleBtn">Click for All Words</button>
<div id="textArea" hidden style="font-family: monospace;">
  <!-- Text lines will appear here -->
</div>
<p></p>
<div id="results" hidden></div>

<script>

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/wordleanalyser/service-worker.js')
  .then(reg => console.log('Service Worker registered', reg))
  .catch(err => console.error('Service Worker registration failed', err));
}

//    if (/iPhone/.test(navigator.userAgent)) {
 // document.getElementById('guessesInput').value = 'ARISE ';
//}

let wordList = [];
let wordListAll = [];
  

function loadWordList() {
   return fetch('words.json')
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.json();
    }) // .then(response
    .then(data => {
      wordList = data.map(w => w.toUpperCase());

    }) // .then(data
       .catch(error => {
       console.error("Failed to load word list:", error);
       })
  
   return fetch('allwords.json')
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.json();
    }) // .then(response
    .then(data => {
      wordListAll = data.map(w => w.toUpperCase());
      document.getElementById('analyzeBtn').disabled = false;
    }) // .then(data
} // function loadWordList

// Return Wordle feedback pattern for guess vs target
// 'G' = green (correct spot), 'Y' = yellow (present wrong spot), 'B' = black (absent)
function wordleFeedback(guess, target) {
  guess = guess.toUpperCase();
  target = target.toUpperCase();
  let feedback = Array(5).fill('B');
  let targetLetters = target.split('');
  
  // First pass for greens
  for (let i = 0; i < 5; i++) {
    if (guess[i] === target[i]) {
      feedback[i] = 'G';
      targetLetters[i] = null; // mark matched
    }
  } // for
  // Second pass for yellows
  for (let i = 0; i < 5; i++) {
    if (feedback[i] === 'B') {
      let index = targetLetters.indexOf(guess[i]);
      if (index !== -1) {
        feedback[i] = 'Y';
        targetLetters[index] = null; // mark matched
      }
    }
  } // for
  return feedback.join('');
} // function wordleFeedback

// Filter word list to only words that produce same feedback for guess as solution feedback
function filterCandidates(candidates, guess, feedback) {
  return candidates.filter(word => wordleFeedback(guess, word) === feedback);
} // function filterCandidates

// Main analyze function
function analyze(isAll) {
  let solution = document.getElementById('solutionInput').value.toUpperCase();
  let guessesRaw = document.getElementById('guessesInput').value.toUpperCase();
  if (solution.length !== 5) {
    alert("Please enter a 5-letter solution word.");
    return;
  }
  let guesses = guessesRaw.split(' ').map(g => g.trim()).filter(g => g.length === 5);
  if (guesses.length === 0) {
    alert("Please enter at least one 5-letter guess, or more separated by spaces.");
    return;
  }
  let remaining;
  if (isAll) {remaining = wordListAll.slice();} else {remaining = wordList.slice();}
  let resultsDiv = document.getElementById('results');
  resultsDiv.innerHTML = '<h2>Results</h2>';
  
  var col;
  const box = document.getElementById('textArea');
  box.textContent = '';
  box.removeAttribute('hidden');
  guesses.forEach((guess, i) => {
    let fb = wordleFeedback(guess, solution);
    var span5 = "";
    for (let j = 0; j < 5; j++) {
      if (fb[j] == 'G') col = 'green';
      else if (fb[j] == 'Y') col = 'goldenrod';
      else col = 'darkslategrey';
  
      span5 = span5 + '<span style="text-align: center; font-size : 20px; color : white; padding : 3px; margin-right : 2px; margin-top : 2px; width: 25px; height: 25px; display : inline-block; background-color: '+col+';">'+guess[j]+'</span>';
    } // for
      const div = document.createElement('div');
      div.innerHTML = span5;
      box.appendChild(div);
    //box.scrollTop = box.scrollHeight; // Scroll to bottom on new line.

    remaining = filterCandidates(remaining, guess, fb);
    
    // Display count and clickable text to show words list
    let container = document.createElement('div');
    let title = document.createElement('strong');
    title.textContent = `After guess ${i+1} (${guess}): ${remaining.length} possible words`;
    container.appendChild(title);

    if (remaining.length > 0) {
      let showBtn = document.createElement('button');
      showBtn.textContent = 'Show Words';
      showBtn.style.marginLeft = '0.5em';
      let wordsList = document.createElement('div');
      wordsList.className = 'words-list';
      wordsList.style.display = 'none';
      remaining.forEach(w => {
        let span = document.createElement('span');
        span.textContent = w;
        wordsList.appendChild(span);
      }); //remaining.forEach

      showBtn.addEventListener('click', () => {
        wordsList.style.display = wordsList.style.display === 'none' ? 'block' : 'none';
        showBtn.textContent = wordsList.style.display === 'none' ? 'Show Words' : 'Hide Words';
      }); // showBtn.addEventListener
      container.appendChild(showBtn);
      container.appendChild(wordsList);
    } // if (remaining.length > 0)
    resultsDiv.appendChild(container);
    resultsDiv.removeAttribute('hidden');
  }); // guesses.forEach
       var span5 = "";
    for (let j = 0; j < 5; j++) {
           span5 = span5 + '<span style="text-align: center; font-size : 20px; color : white; padding : 3px; margin-right : 2px; margin-top : 2px; width: 25px; height: 25px; display : inline-block; background-color: green;">'+solution[j]+'</span>';
    } //for
        const div = document.createElement('div');
      div.innerHTML = span5;
      box.appendChild(div);

} // function analyze

loadWordList();
        const btn = document.getElementById('toggleBtn');
        let isAll = false; // Initial state
        
        btn.addEventListener('click', function() {
            isAll = !isAll; // Toggle state
            
            if (isAll) {
                btn.textContent = 'Click for All Words';
            } else {
                btn.textContent = 'Click for Solution Words';
           }
        });
        
document.getElementById('analyzeBtn').addEventListener('click', analyze(isAll));

</script>

</body>
</html>
